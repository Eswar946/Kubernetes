apiVersion: apps/v1
kind: Deployment
metadata:
    name: springapp    
    namespace: eswar-ns
spec:
    replicas: 2
    selector:
       matchLabels:
           app: springapp
    template:
       metadata:
         labels:
            app: springapp
       spec:
         containers:
         - name: springapp
           image: dockerhandson/spring-boot-mongo:1
           resources:
             requests:
                 memory: "128Mi"
                 cpu: "200m"
             limits:
                 memory: "256Mi"
                 cpu: "400m"
           ports:
           - containerPort: 8080
           env:
           - name: MANGO_DB_HOSTNAME
             value: mongosvc
           - name: MANGO_DB_USERNAME
             value: devdb
           - name: MANGO_DB_PASSWORD
             value: devdb@123
---
apiVersion: v1
kind: Service
metadata:
    name: springappsvc
    namespace: eswar-ns
spec:
    type: NodePort
    selector:
        app: springapp
    ports:
    - port: 8080
      targetPort: 8080
---
apiVersion: apps/v1
kind: ReplicaSet
metadata:
    name: mongo
    namespace: eswar-ns
spec:
    replicas: 1
    selector:
       matchLabels:
           app: mongo
    template:
       metadata:
         labels:
            app: mongo
       spec:
         containers:
         - name: mongo
           image: mongo
           ports:
           - containerPort: 27017
           resources:
             requests:
                cpu: 300m
                memory: 256Mi
             limits:
                cpu: 500m
                memory: 512Mi
           env:  
           - name: MANGO_DB_USERNAME
             value: devdb
           - name: MANGO_DB_PASSWORD
             value: devdb@123
           volumeMounts:
           - name: mongovol
             mountPath: /data/db
         volumes:
         - name: mongovol
           nfs:
             server: 172.31.82.175
             path: /mnt/nfs-share
---
apiVersion: v1
kind: Service
metadata:
    name: mongosvc
spec: 
    selector:
        app: mongo
    ports:
    - port: 27017
      targetPort: 27017

